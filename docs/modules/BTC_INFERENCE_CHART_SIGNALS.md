# BTC Inference Chart Signals (Markers Overlay)

## Purpose
This document describes how the **BTC Live Inference** price chart renders
**LONG/SHORT entry markers** on top of the candlestick chart.

It applies to the Streamlit UI section:
- **ML → Train → Training → Bitcoin Live Inference**

## Responsibilities
The marker overlay is responsible for:
- Taking the discrete per-candle `signal` values generated by the inference
  pipeline.
- Mapping those signals to **visual markers** on the price panel.
- Keeping markers readable on a dark theme and avoiding overlap with candles.

## Inputs / Outputs

### Inputs
The overlay reads from the inference DataFrame produced by
`services/local_models.run_inference()`.

Required columns:
- `timestamp`
- `high`, `low`, `close`
- `signal` in `{STRONG BUY, BUY, HOLD, SELL, STRONG SELL}`

### Output
The overlay contributes additional Plotly `Scatter` traces to the figure.

## Marker Mapping

The UI groups discrete `signal` values into two user-facing entry classes:

| Entry | Signals | Marker | Position | Label |
|------:|---------|--------|----------|-------|
| LONG  | `BUY`, `STRONG BUY` | `triangle-up` | below candle (`low - offset`) | `LONG` |
| SHORT | `SELL`, `STRONG SELL` | `triangle-down` | above candle (`high + offset`) | `SHORT` |
| (none) | `HOLD` | (none) | - | - |

## Readability Rules (Dark Theme)
- Markers use high-contrast colors from `shared/colors.py` (LONG = `COLORS['long']`, SHORT = `COLORS['short']`).
- Marker size is increased to remain visible at typical chart zoom levels.
- Labels are kept short (`LONG` / `SHORT`) to reduce clutter on dense charts.

## Dependencies
- Plotly (`plotly.graph_objects`)
- Pandas
- Train tab shared colors (`agents/frontend/components/tabs/train/shared/colors.py`)

## Limitations
- Plotly scatter text does not support a true text background (bubble) per point.
  To avoid unreadable text on top of candles, labels are short and markers are
  positioned with a small price-based offset.
